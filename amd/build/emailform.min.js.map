{"version":3,"sources":["../src/emailform.js"],"names":["define","Axios","Alertify","template","props","data","close_icon","valid_form","subject_label","strings","subject_rules","v","validation_subject_text","message","message_label","message_rules","validation_message_text","submit_button","cancel_button","emailform_title","sending_text","recipients","recipients_label","loader_dialog","mailsended_text","methods","get_picture_url","userid","url","M","cfg","wwwroot","submit","selected_users","forEach","item","concat","id","errors","action","subject","text","courseid","moduleid","modulename","method","params","then","response","status","ok","$emit","$refs","form","reset","success","error","api_error_network","catch","finally","resetValidation","closeDialog"],"mappings":"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","sourcesContent":["define([\r\n    \"local_fliplearning/axios\",\r\n    \"local_fliplearning/alertify\",\r\n    ],\r\n    function (Axios, Alertify){\r\n        const emailform = {\r\n        template:`\r\n                <v-main mt-10>\r\n                    <v-row>\r\n                        <v-col sm=\"12\">\r\n                            <v-dialog\r\n                                v-model=\"dialog\"\r\n                                width=\"800\"\r\n                                @click:outside=\"closeDialog()\"\r\n                                @keydown.esc=\"closeDialog()\"\r\n                            >\r\n                                <v-card>\r\n                                    <v-toolbar color=\"#118AB2\" dark>\r\n                                        <span v-text=\"emailform_title\"></span>\r\n                                        <v-spacer></v-spacer>\r\n                                        <v-btn icon @click=\"reset\">\r\n                                            <v-icon v-text=\"close_icon\"></v-icon>\r\n                                        </v-btn>\r\n                                    </v-toolbar>\r\n        \r\n                                    <v-container>\r\n                                        <v-row>\r\n                                            <v-col cols=\"12\" sm=\"12\">\r\n    \r\n                                                <v-chip class=\"ma-2\" color=\"#118AB2\" label dark>\r\n                                                    <span v-text=\"recipients\"></span>\r\n                                                </v-chip>\r\n    \r\n                                                <template v-for=\"(user, index, key) in selected_users\">\r\n                                                    <v-chip class=\"ma-2\">\r\n                                                        <v-avatar left>\r\n                                                            <img :src=\"get_picture_url(user.id)\">\r\n                                                        </v-avatar>\r\n                                                        <span>{{user.firstname}} {{user.lastname}}</span>\r\n                                                    </v-chip>\r\n                                                </template>\r\n    \r\n                                            </v-col>\r\n                                        </v-row>\r\n    \r\n                                        <v-row>\r\n                                            <v-col cols=\"12\" sm=\"12\">\r\n                                                <v-form ref=\"form\" v-model=\"valid_form\">\r\n                                                    <v-text-field\r\n                                                            v-model=\"strings.subject\"\r\n                                                            :label=\"subject_label\"\r\n                                                            :rules=\"subject_rules\"\r\n                                                            required\r\n                                                            solo\r\n                                                    ></v-text-field>\r\n    \r\n                                                    <v-textarea\r\n                                                            v-model=\"message\"\r\n                                                            :label=\"message_label\"\r\n                                                            :rules=\"message_rules\"\r\n                                                            required\r\n                                                            solo\r\n                                                    ></v-textarea>\r\n    \r\n                                                    <v-btn @click=\"submit\" :disabled=\"!valid_form\">\r\n                                                        <span v-text=\"submit_button\"></span>\r\n                                                    </v-btn>\r\n    \r\n                                                    <v-btn @click=\"reset\">\r\n                                                        <span v-text=\"cancel_button\"></span>\r\n                                                    </v-btn>\r\n    \r\n                                                    <v-spacer></v-spacer>\r\n    \r\n                                                </v-form>\r\n                                            </v-col>\r\n                                        </v-row>\r\n                                    </v-container>\r\n        \r\n                                </v-card>\r\n                            </v-dialog>\r\n                        </v-col>\r\n                    </v-row>\r\n                    \r\n                    <v-row>\r\n                        <v-col sm=\"12\">\r\n                            <div class=\"text-center\">\r\n                                <v-dialog\r\n                                        v-model=\"loader_dialog\"\r\n                                        persistent\r\n                                        width=\"300\"\r\n                                >\r\n                                    <v-card color=\"#118AB2\" dark>\r\n                                        <v-card-text>\r\n                                            <span v-text=\"sending_text\"></span>\r\n                                            <v-progress-linear\r\n                                                    indeterminate\r\n                                                    color=\"white\"\r\n                                                    class=\"mb-0\"\r\n                                            ></v-progress-linear>\r\n                                        </v-card-text>\r\n                                    </v-card>\r\n                                </v-dialog>\r\n                            </div>\r\n                        </v-col>\r\n                    </v-row>\r\n               </v-main>\r\n                `,\r\n        props:['dialog', 'selected_users', 'strings', 'moduleid', 'modulename', 'courseid', 'userid'],\r\n        data(){\r\n            return {\r\n                close_icon: 'mdi-minus',\r\n                valid_form: true,\r\n                subject_label: this.strings.subject_label,\r\n                subject_rules: [\r\n                    v => !!v || this.strings.validation_subject_text,\r\n                ],\r\n                message: '',\r\n                message_label: this.strings.message_label,\r\n                message_rules: [\r\n                    v => !!v || this.strings.validation_message_text,\r\n                ],\r\n                submit_button: this.strings.submit_button,\r\n                cancel_button: this.strings.cancel_button,\r\n                emailform_title: this.strings.emailform_title,\r\n                sending_text: this.strings.sending_text,\r\n                recipients: this.strings.recipients_label,\r\n\r\n                loader_dialog: false,\r\n                mailsended_text: this.strings.mailsended_text,\r\n            }\r\n        },\r\n        methods : {\r\n            get_picture_url(userid){\r\n                let url = `${M.cfg.wwwroot}/user/pix.php?file=/${userid}/f1.jpg`;\r\n                return url;\r\n            },\r\n\r\n            submit () {\r\n                let recipients = \"\";\r\n                this.selected_users.forEach(item => {\r\n                    recipients=recipients.concat(item.id,\",\");\r\n                });\r\n                this.loader_dialog = true;\r\n                this.errors = [];\r\n                let data = {\r\n                    action : \"sendmail\",\r\n                    subject : this.strings.subject,\r\n                    recipients : recipients,\r\n                    text : this.message,\r\n                    userid : this.userid,\r\n                    courseid : this.courseid,\r\n                    moduleid : this.moduleid,\r\n                    modulename : this.modulename,\r\n                };\r\n                Axios({\r\n                    method:'get',\r\n                    url: M.cfg.wwwroot + \"/local/fliplearning/ajax.php\",\r\n                    params : data,\r\n                }).then((response) => {\r\n                    if (response.status == 200 && response.data.ok) {\r\n                        this.$emit('update_dialog', false);\r\n                        this.$refs.form.reset();\r\n                        Alertify.success(this.mailsended_text);\r\n                    } else {\r\n                        Alertify.error(this.strings.api_error_network);\r\n                        this.loader_dialog = false;\r\n                    }\r\n                }).catch((e) => {\r\n                    Alertify.error(this.strings.api_error_network);\r\n                }).finally(() => {\r\n                    this.loader_dialog = false;\r\n                });\r\n            },\r\n\r\n            reset () {\r\n                this.$emit('update_dialog', false);\r\n                this.$refs.form.resetValidation();\r\n            },\r\n\r\n            closeDialog() {\r\n                this.$emit('update_dialog', false);\r\n            }\r\n        },\r\n    }\r\n    return emailform;\r\n})"],"file":"emailform.min.js"}