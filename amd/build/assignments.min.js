define(["local_fliplearning/vue","local_fliplearning/vuetify","local_fliplearning/axios","local_fliplearning/moment","local_fliplearning/pagination","local_fliplearning/chartdynamic","local_fliplearning/pageheader","local_fliplearning/emailform","local_fliplearning/helpdialog"],function(e,s,t,i,n,o,a,c,r){"use strict";return{init:function(i){e.use(s),e.component("pagination",n),e.component("chart",o),e.component("pageheader",a),e.component("emailform",c),e.component("helpdialog",r);let l=new e({delimiters:["[[","]]"],el:"#submissions",vuetify:new s,data:()=>({dialog:!1,selected_users:[],modulename:"",moduleid:!1,strings:i.strings,groups:i.groups,userid:i.userid,courseid:i.courseid,timezone:i.timezone,render_has:i.profile_render,scriptname:i.scriptname,loading:!1,errors:[],pages:i.pages,submissions:i.submissions,email_strings:i.strings.email_strings,access:i.access,assigns_submissions_colors:i.assigns_submissions_colors,access_content_colors:i.access_content_colors,access_chart_categories:[],access_chart_series:[],access_chart_users:[],help_dialog:!1,help_contents:[]}),beforeMount(){this.generate_access_content_data()},mounted(){document.querySelector("#sessions-loader").style.display="none",document.querySelector("#submissions").style.display="block"},methods:{get_help_content(){let e=[];return e.push({title:this.strings.section_help_title,description:this.strings.section_help_description}),e},update_interactions(e){this.loading=!0,this.errors=[];let s={action:"assignments",userid:this.userid,courseid:this.courseid,weekcode:e.weekcode,profile:this.render_has};return t({method:"get",url:M.cfg.wwwroot+"/local/fliplearning/ajax.php",params:s}).then(e=>{200==e.status&&e.data.ok?(this.submissions=e.data.data.submissions,this.access=e.data.data.access,this.generate_access_content_data()):this.error_messages.push(this.strings.error_network)}).catch(e=>{this.errors.push(this.strings.api_error_network)}).finally(()=>{this.loading=!1}),this.data},build_assigns_submissions_chart(){let e=new Object;return e.chart={type:"column",backgroundColor:null,style:{fontFamily:"poppins"}},e.title={text:null},e.colors=this.assigns_submissions_colors,e.xAxis={categories:this.submissions.categories,crosshair:!0},e.yAxis={min:0,title:{text:this.strings.assignsubs_chart_yaxis},allowDecimals:!1},e.tooltip={formatter:function(){let e=this.x.split("</b>");e=(e=(e=e[0]||"").split("<b>"))[1]||"";let s=this.series.name,t=this.y,i=l.strings.students_text,n=l.strings.send_mail;return 1==t&&(i=l.strings.student_text),"<b>"+e+"</b><br/><b>"+s+": </b>"+t+" "+i+"<br/>"+n}},e.plotOptions={series:{cursor:"pointer",point:{events:{click:function(){let e=this.category.split("</b>");e=(e=(e=e[0]||"").split("<b>"))[1]||"",l.email_strings.subject=l.email_strings.subject_prefix+" - "+e;let s=this.x,t=this.series.colorIndex;l.dialog=!0,l.selected_users=l.submissions.users[s][t],l.moduleid=l.submissions.modules[s],l.modulename="assign",l.scriptname="test"}}}}},e.series=this.submissions.data,e},build_access_content_chart(){let e=new Object;return e.chart={type:"bar",backgroundColor:null,style:{fontFamily:"poppins"}},e.title={text:null},e.colors=this.access_content_colors,e.xAxis={categories:this.access_chart_categories,title:{text:null},crosshair:!0},e.yAxis={min:0,title:{text:this.strings.access_chart_yaxis_label},labels:{overflow:"justify"},allowDecimals:!1},e.tooltip={formatter:function(){let e=this.x,s=this.series.name,t=this.y,i=l.strings.students_text,n=l.strings.send_mail;return 1==t&&(i=l.strings.student_text),"<b>"+e+"</b><br/><b>"+s+": </b>"+t+" "+i+"<br/>"+n}},e.plotOptions={bar:{dataLabels:{enabled:!1}},series:{cursor:"pointer",point:{events:{click:function(){let e=this.category;l.email_strings.subject=l.email_strings.subject_prefix+" - "+e;let s=this.x,t=this.series.colorIndex,i=l.get_users(l.access_chart_users[s][t]);l.selected_users=i;let n=l.get_moduletype(this.category);l.modulename=n.type,l.moduleid=n.id,l.dialog=!0,l.scriptname="test"}}}}},e.series=this.access_chart_series,e},update_dialog(e){this.dialog=e},generate_access_content_data(){let e=[];this.access.users.forEach(s=>{e.push(Number(s.id))});let s=[];this.access.types.forEach(e=>{e.show&&s.push(e.type)});let t=[];this.access.modules.forEach(e=>{s.includes(e.type)&&t.push(e)});let i=[],n=[],o=[],a=[];t.forEach(s=>{i.push(s.name);let t=s.users,c=e.filter(e=>!t.includes(e));o.push(t.length),a.push(c.length),n.push([t,c])});let c=[{name:this.strings.access,data:o},{name:this.strings.no_access,data:a}];this.access_chart_categories=i,this.access_chart_series=c,this.access_chart_users=n},get_users(e){let s=[];return this.access.users.forEach(t=>{let i=Number(t.id);e.includes(i)&&s.push(t)}),s},get_moduletype(e){let s;return this.access.modules.forEach(t=>{t.name===e&&(s=t)}),s},open_chart_help(e){let s=[];"assigns_submissions"==e?(s.push({title:this.strings.assigns_submissions_help_title,description:this.strings.assigns_submissions_help_description_p1}),s.push({description:this.strings.assigns_submissions_help_description_p2})):"access_content"==e&&(s.push({title:this.strings.access_content_help_title,description:this.strings.access_content_help_description_p1}),s.push({description:this.strings.access_content_help_description_p2})),this.help_contents=s,this.help_contents.length&&(this.help_dialog=!0)},update_help_dialog(e){this.help_dialog=e},get_timezone(){return`${this.strings.ss_change_timezone} ${this.timezone}`}}});function h(){let e=document.getElementsByClassName("highcharts-a11y-proxy-button");e[0].id="filterSubmissions",e[1].id="filterSubmissions",e[2].id="filterSubmissions",e[3].id="submissions",e[6].id="accessContent";for(let s=0;s<e.length;s++)e[s].addEventListener("click",function(){let e=this.id,t=document.getElementsByClassName("highcharts-menu");for(s=0;s<t.length;s++)t[s].addEventListener("mouseenter",function(){this.id=e;let s=this.children;for(let e=0;e<s.length;e++)s[e].id=this.id,s[e].addEventListener("click",g)});switch(this.id){case"filterSubmissions":m("filtered","submissions","graphic","Filter that allows to see only certain information of the graph submissions")}});let s=document.querySelectorAll(".highcharts-container");s[0].id="submissions",s[1].id="accessContent",s.forEach(e=>{e.addEventListener("mouseenter",d)}),document.querySelectorAll(".v-input--selection-controls__ripple").forEach(e=>{e.addEventListener("click",function(){m("filtered","accessed_content","graphic","Filter that allows to see only certain information of the graph access content"),p()})}),document.querySelectorAll(".pa-1.pr-4.pl-4.page.selected-page").forEach(e=>{e.addEventListener("click",function(){m("viewed",e.innerHTML,"week_section","Week section that allows you to obtain information on a specific week"),setTimeout(h,1e3)})}),document.querySelectorAll(".caption").forEach(e=>{e.addEventListener("click",u)})}function d(e){event.stopPropagation();var s="",t="",i="",n="";switch(this.id){case"submissions":s="viewed",t="submissions",i="graphic",n="Graph showing the work submited by the students";break;case"accessContent":s="viewed",t="accessContent",i="graphic",n="Graph showing the course content accessed by the students";break;default:s="viewed",t="",i="graphic",n="A graphic"}m(s,t,i,n)}function u(e){event.stopPropagation();var s="",t="",i="",n="";switch(this.id){case"helpSubmissions":s="viewed",i="help",t="submissions",n="Help section that provides information about the invested time graph";break;case"helpAccessContent":s="viewed",i="help",t="accessed_content",n="Help section that provides information about the sessions per hour graph";break;default:s="viewed",i="help",t="",n="Help section of a graph"}m(s,t,i,n)}function p(){document.getElementsByClassName("highcharts-legend-item highcharts-bar-series highcharts-color-0 highcharts-series-0")[0].addEventListener("click",function(){m("filtered","accessed_content","graphic","Filter that allows to see only certain information of the graph access content")}),document.getElementsByClassName("highcharts-legend-item highcharts-bar-series highcharts-color-1 highcharts-series-1")[0].addEventListener("click",function(){m("filtered","accessed_content","graphic","Filter that allows to see only certain information of the graph access content")})}function g(e){this.removeEventListener("click",g);var s="",t="",i="",n="";switch(this.id){case"submissions":s="downloaded",t="submissions",i="graphic",n="Bar graph that shows submissed works by students";break;case"accessContent":s="downloaded",t="accessed_content",i="graphic",n="Graph showing the content wich have been accessed by students";break;default:s="downloaded",t="",i="graphic",n="Downloaded a graph"}m(s,t,i,n)}function m(e,s,n,o){console.log("Action: "+e+", ObjectName: "+s+", ObjectType: "+n+", ObjectDescription: "+o);let a={courseid:i.courseid,userid:i.userid,action:"addLogs",sectionname:"TEACHER_STUDY_SESSIONS",actiontype:e,objectType:n,objectName:s,currentUrl:document.location.href,objectDescription:o};t({method:"get",url:M.cfg.wwwroot+"/local/fliplearning/ajax.php",params:a}).then(e=>{200==e.status&&e.data.ok?console.log("Information envoyée"):console.log("Information non envoyée")}).catch(e=>{console.log("Problème rencontré")})}setTimeout(function(){h(),p()},1e3)}}});
//# sourceMappingURL=assignments.min.js.map
