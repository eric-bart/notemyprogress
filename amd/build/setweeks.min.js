define(["local_fliplearning/vue","local_fliplearning/vuetify","local_fliplearning/axios","local_fliplearning/sortablejs","local_fliplearning/draggable","local_fliplearning/datepicker","local_fliplearning/moment","local_fliplearning/alertify","local_fliplearning/pageheader"],function(e,s,t,r,i,n,a,o,l){"use strict";return{init:function(r){r=function(e){for(let s=0;s<e.weeks.length;s++){let t=e.weeks[s];void 0===t.collapsabled&&(t.collapsabled=!1)}return e}(r),e.use(s),e.component("draggable",i),e.component("datepicker",n),e.component("pageheader",l),new e({delimiters:["[[","]]"],el:"#setweeks",vuetify:new s,data:{display_settings:!1,settings:r.settings,new_group:!1,scroll_mode:!1,weeks_started_at:new Date(a(1e3*Number(r.weeks[0].weekstart))),strings:r.strings,sections:r.sections,courseid:r.courseid,userid:r.userid,raw_weeks:r.weeks,disabled_dates:{days:[0,2,3,4,5,6]},saving_loader:!1,error_messages:[],save_successful:!1},mounted(){document.querySelector("#setweeks-loader").style.display="none",document.querySelector("#setweeks").style.display="block"},computed:{weeks(){for(let e=0;e<this.raw_weeks.length;e++){let s=this.raw_weeks[e];if(0==e){let e=this.weeks_started_at;s.weekstart=e,s.weekend=this.get_end_week(this.weeks_started_at)}else s.weekstart=this.get_start_week(this.raw_weeks[e-1].weekend),s.weekend=this.get_end_week(s.weekstart)}return this.raw_weeks}},methods:{section_name(e){let s=null;return s=void 0!==e.section_name&&e.section_name.length>0?e.section_name:e.name},section_exist(e){let s=!0;return void 0!==e&&void 0!==e.exists&&0==e.exists&&(s=!1),s},format_name:(e,s)=>e+" "+(s+1),customFormatter:e=>a(e).format("YYYY-MM-DD"),add_week(){this.raw_weeks.push({name:this.strings.week,position:this.weeks.length+1,weekstart:null,weekend:null,collapsabled:!1,hours_dedications:0,removable:!0,sections:[]})},has_items:e=>e.length>0,remove_week(e,s){if(0==s)return null;this.close_delete_confirm();for(let s=0;s<e.sections.length;s++)this.sections.push(e.sections[s]);let t=this.raw_weeks.indexOf(e);this.raw_weeks.splice(t,1)},ask_delete_confirm(){this.delete_confirm=!0},close_delete_confirm(){this.delete_confirm=!1},get_start_week:e=>a(a(e).add(1,"days")).format("YYYY-MM-DD"),get_end_week:e=>a(a(e).add(6,"days")).format("YYYY-MM-DD"),get_date_next_day(e,s,t=null){e=e.toLowerCase();let r=a(s).format("dddd").toLowerCase();for(;r!=e;)s=a(s).add(1,"days"),r=a(s).format("dddd").toLowerCase();return t?s=s.format(t):"number"!=typeof s&&(s=parseInt(s.format("x"))),s},position:e=>`${++e} - `,save_changes(){return this.save_successful=!1,this.error_messages=[],this.empty_weeks()?(this.saving_loader=!1,o.error(this.strings.error_empty_week),this.error_messages.push(this.strings.error_empty_week),!1):this.weeks_deleted_from_course()?(this.saving_loader=!1,this.error_messages.push(this.strings.error_section_removed),!1):void o.confirm(this.strings.save_warning_content,()=>{this.saving_loader=!0;var e=this.weeks;e[0].weekstart=a(e[0].weekstart).format("YYYY-MM-DD");var s={action:"saveconfigweek",userid:this.userid,courseid:this.courseid,newinstance:this.new_group,weeks:this.minify_query(e),currentUrl:window.location.href};t({method:"get",url:M.cfg.wwwroot+"/local/fliplearning/ajax.php",params:s}).then(e=>{200==e.status&&e.data.ok?(this.settings=e.data.data.settings,o.success(this.strings.save_successful),this.save_successful=!0):(o.error(this.strings.error_network),this.error_messages.push(this.strings.error_network))}).catch(e=>{o.error(this.strings.error_network),this.error_messages.push(this.strings.error_network)}).finally(()=>{this.saving_loader=!1})},()=>{this.saving_loader=!1,o.warning(this.strings.cancel_action)}).set({title:this.strings.save_warning_title}).set({labels:{cancel:this.strings.confirm_cancel,ok:this.strings.confirm_ok}})},minify_query(e){var s=[];return e.forEach(e=>{var t=new Object;t.h=e.hours_dedications,t.s=e.weekstart,t.e=e.weekend,t.sections=[],e.sections.forEach(e=>{var s=new Object;s.sid=e.sectionid,t.sections.push(s)}),s.push(t)}),JSON.stringify(s)},empty_weeks(){if(this.weeks.length>=2&&this.weeks[0].sections.length<1)return!0;for(let e=0;e<this.weeks.length;e++)if(e>0&&this.weeks[e].sections.length<=0)return!0;return!1},weeks_deleted_from_course(){for(var e=0;e<this.weeks.length;e++)for(var s=0;s<this.weeks[e].sections.length;s++)if(!this.section_exist(this.weeks[e].sections[s]))return!0;return!1},exists_mistakes(){return this.error_messages.length>0},change_collapsabled(e){this.raw_weeks[e].collapsabled=!this.raw_weeks[e].collapsabled},course_finished(){let e=!1,s=this.weeks.length-1,t=a(this.weeks[s].weekend).format("X");return e=a().format("X")>t},get_settings_status(){let e=!0;return Object.keys(this.settings).map(s=>{this.settings[s]||(e=!1)}),e?this.strings.plugin_visible:this.strings.plugin_hidden},get_help_content(){var e=[],s=new Object;return s.title=this.strings.title,s.description=this.strings.description,e.push(s),e}}})}}});
//# sourceMappingURL=setweeks.min.js.map
