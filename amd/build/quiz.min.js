define ("local_fliplearning/quiz",["local_fliplearning/vue","local_fliplearning/vuetify","local_fliplearning/axios","local_fliplearning/moment","local_fliplearning/pagination","local_fliplearning/chartdynamic","local_fliplearning/pageheader","local_fliplearning/helpdialog"],function(a,b,c,d,e,f,g,h){"use strict";return{init:function(d){a.use(b);a.component("pagination",e);a.component("chart",f);a.component("pageheader",g);a.component("helpdialog",h);var i=new a({delimiters:["[[","]]"],el:"#quiz",vuetify:new b,data:function data(){return{strings:d.strings,groups:d.groups,userid:d.userid,courseid:d.courseid,timezone:d.timezone,render_has:d.profile_render,loading:!1,errors:[],pages:d.pages,quiz:d.quiz,questions_attempts_colors:d.questions_attempts_colors,hardest_questions_colors:d.hardest_questions_colors,default_quiz:null,attempts_categories:[],attempts_series:[],attempts_questions:[],hardest_categories:[],hardest_series:[],hardest_questions:[],help_dialog:!1,help_contents:[]}},beforeMount:function beforeMount(){if(this.quiz.length){this.default_quiz=this.quiz[0].attempts;this.calculate_questions_attempts(this.default_quiz)}},mounted:function mounted(){document.querySelector("#sessions-loader").style.display="none";document.querySelector("#quiz").style.display="block"},methods:{get_help_content:function get_help_content(){var a=[{title:this.strings.section_help_title,description:this.strings.section_help_description}];return a},get_quiz_info_text1:function get_quiz_info_text1(){var a="";if(this.default_quiz){var b=this.default_quiz.details.questions,c=this.strings.questions_text;if(1==b){c=this.strings.question_text}a="* ".concat(this.strings.quiz_info_text," ").concat(b," ").concat(c)}return a},get_quiz_info_text2:function get_quiz_info_text2(){var a="";if(this.default_quiz){var b=this.default_quiz.details.attempts,c=this.strings.doing_text_plural;if(1==b){c=this.strings.doing_text_singular}var d=this.default_quiz.details.users,e=this.strings.students_text;if(1==d){e=this.strings.student_text}a="* ".concat(b," ").concat(c," ").concat(d," ").concat(e)}return a},build_questions_attempts_chart:function build_questions_attempts_chart(){var a={};a.chart={type:"column",backgroundColor:null,style:{fontFamily:"poppins"}};a.title={text:null};a.colors=this.questions_attempts_colors;a.xAxis={categories:this.attempts_categories};a.yAxis=[{min:0,allowDecimals:!1,title:{text:this.strings.questions_attempts_yaxis_title}}];a.tooltip={formatter:function formatter(){var a=this.x,b=this.y,c=this.total,d=Math.round(+this.percentage),e=this.series.name,f=i.strings.attempts_text;f=f.charAt(0).toUpperCase()+f.slice(1);var g=i.strings.attempts_text,h=i.strings.of_conector,j=i.strings.review_question;if(1==b){g=i.strings.attempt_text}var k="<b>"+a+": </b>"+f+" "+e+"<br/>"+b+" "+g+" "+h+" "+c+" ("+d+"%)<br/>"+j;return k}};a.plotOptions={column:{stacking:"normal"},series:{cursor:"pointer",point:{events:{click:function click(){var a=i.attempts_questions[this.x],b=a.id,c=M.cfg.wwwroot+"/question/preview.php?id="+b+"&courseid="+i.courseid;window.open(c,"_blank","top=50,left=50,width=900,height=600")}}}}};a.series=this.attempts_series;return a},build_hardest_questions_chart:function build_hardest_questions_chart(){var a={};a.chart={type:"column",backgroundColor:null,style:{fontFamily:"poppins"}};a.title={text:null};a.colors=this.hardest_questions_colors;a.xAxis={categories:this.hardest_categories};a.legend={enabled:!1};a.tooltip={formatter:function formatter(){var a=this.point.x,b=i.hardest_questions[a],c=this.x,d=this.series.name,e=this.y,f=i.strings.attempts_text,g=i.strings.of_conector,h=i.strings.review_question;if(1==b.ha){f=i.strings.attempt_text}var j="<b>"+c+": </b>"+d+"<br/>"+b.ha+" "+f+" "+g+" "+b.to+" ("+e+"%)<br/>"+h;return j}};a.yAxis=[{min:0,allowDecimals:!1,title:{text:this.strings.hardest_questions_yaxis_title},labels:{format:"{value} %"}}];a.plotOptions={series:{cursor:"pointer",point:{events:{click:function click(){var a=i.hardest_questions[this.x],b=a.id,c=M.cfg.wwwroot+"/question/preview.php?id="+b+"&courseid="+i.courseid;window.open(c,"_blank","top=50,left=50,width=900,height=600")}}}}};a.series=this.hardest_series;return a},calculate_questions_attempts:function calculate_questions_attempts(a){var b=a.questions,c=[],d=1,e="",f=[],g=[],h=[],i=[],j=[],k=[],l=[],m,n,o,p,q,r,s=0;b.forEach(function(a){m,n,o,p,q,r=0;m=(a.gradedright||0)+(a.mangrright||0);n=(a.gradedpartial||0)+(a.mangrpartial||0);o=(a.gradedwrong||0)+(a.mangrwrong||0);p=(a.gaveup||0)+(a.mangaveup||0);q=(a.needsgrading||0)+(a.mangaveup||0)+(a.finished||0)+(a.manfinished||0);f.push(m);g.push(n);h.push(o);i.push(p);j.push(q);e="P"+d;s=n+o+p;r=m+n+o+p+q;k.push({id:a.id,qu:e,ha:s,to:r,pe:Math.round(100*s/r)});c.push(e);l.push(a);d++});var t=[{name:this.strings.correct_attempt,data:f},{name:this.strings.partcorrect_attempt,data:g},{name:this.strings.incorrect_attempt,data:h},{name:this.strings.blank_attempt,data:i},{name:this.strings.needgraded_attempt,data:j}],u=[],v=[],w=[];k.sort(this.compare_hardest);k.forEach(function(a){if(a.pe){u.push(a.qu);v.push(a.pe);w.push(a)}});var x=[{name:this.strings.hardest_questions_yaxis_title,data:v}];this.attempts_categories=c;this.attempts_series=t;this.attempts_questions=l;this.hardest_categories=u;this.hardest_series=x;this.hardest_questions=w},update_interactions:function update_interactions(a){var b=this;this.loading=!0;this.errors=[];var d={action:"quiz",userid:this.userid,courseid:this.courseid,weekcode:a.weekcode,profile:this.render_has};c({method:"get",url:M.cfg.wwwroot+"/local/fliplearning/ajax.php",params:d}).then(function(a){if(200==a.status&&a.data.ok){b.quiz=a.data.data.quiz;if(b.quiz.length){b.default_quiz=b.quiz[0].attempts;b.calculate_questions_attempts(b.default_quiz)}else{b.reset_graphs()}}else{b.error_messages.push(b.strings.error_network)}}).catch(function(){b.errors.push(b.strings.api_error_network)}).finally(function(){b.loading=!1});return this.data},reset_graphs:function reset_graphs(){this.default_quiz=null;this.attempts_categories=[];this.attempts_series=[];this.attempts_questions=[];this.hardest_categories=[];this.hardest_series=[];this.hardest_questions=[]},compare_hardest:function compare_hardest(c,a){if(c.pe>a.pe){return-1}if(c.pe<a.pe){return 1}return 0},open_chart_help:function open_chart_help(a){var b=[];if("questions_attempts"==a){b.push({title:this.strings.questions_attempts_help_title,description:this.strings.questions_attempts_help_description_p1});b.push({description:this.strings.questions_attempts_help_description_p2});b.push({description:this.strings.questions_attempts_help_description_p3})}else if("hardest_questions"==a){b.push({title:this.strings.hardest_questions_help_title,description:this.strings.hardest_questions_help_description_p1});b.push({description:this.strings.hardest_questions_help_description_p2});b.push({description:this.strings.hardest_questions_help_description_p3})}this.help_contents=b;if(this.help_contents.length){this.help_dialog=!0}},update_help_dialog:function update_help_dialog(a){this.help_dialog=a},get_timezone:function get_timezone(){var a="".concat(this.strings.ss_change_timezone," ").concat(this.timezone);return a}}})}}});
//# sourceMappingURL=quiz.min.js.map
